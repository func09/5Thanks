(function(a){var b=function(){var a=function(){};return a.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,c,d){d||(this.context=b,this.buffer=[]);if(!this.includes("",a)){if(d)return a;this.send(a);return}a=this.render_pragmas(a),a=this.render_section(a,b,c);if(d)return this.render_tags(a,b,c,d);this.render_tags(a,b,c,d)},send:function(a){a!=""&&this.buffer.push(a)},render_pragmas:function(a){if(!this.includes("%",a))return a;var b=this;return a.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(a,c,d){if(!b.pragmas_implemented[c])throw{message:"This implementation of mustache doesn't understand the '"+c+"' pragma"};return b.pragmas[c]={},d&&(a=d.split("="),b.pragmas[c][a[0]]=a[1]),""})},render_partial:function(a,b,c){a=this.trim(a);if(!c||c[a]===undefined)throw{message:"unknown_partial '"+a+"'"};return typeof b[a]!="object"?this.render(c[a],b,c,!0):this.render(c[a],b[a],c,!0)},render_section:function(a,b,c){if(!this.includes("#",a)&&!this.includes("^",a))return a;var d=this;return a.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(a,e,f,g){a=d.find(f,b);if(e=="^")return!a||d.is_array(a)&&a.length===0?d.render(g,b,c,!0):"";if(e=="#")return d.is_array(a)?d.map(a,function(a){return d.render(g,d.create_context(a),c,!0)}).join(""):d.is_object(a)?d.render(g,d.create_context(a),c,!0):typeof a=="function"?a.call(b,g,function(a){return d.render(a,b,c,!0)}):a?d.render(g,b,c,!0):""})},render_tags:function(a,b,c,d){var e=this,f=function(){return RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")},g=f(),h=function(a,d,h){switch(d){case"!":return"";case"=":return e.set_delimiters(h),g=f(),"";case">":return e.render_partial(h,b,c);case"{":return e.find(h,b);default:return e.escape(e.find(h,b))}};a=a.split("\n");for(var i=0;i<a.length;i++)a[i]=a[i].replace(g,h,this),d||this.send(a[i]);if(d)return a.join("\n")},set_delimiters:function(a){a=a.split(" "),this.otag=this.escape_regex(a[0]),this.ctag=this.escape_regex(a[1])},escape_regex:function(a){return arguments.callee.sRE||(arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g")),a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){a=this.trim(a);var c;if(b[a]===!1||b[a]===0||b[a])c=b[a];else if(this.context[a]===!1||this.context[a]===0||this.context[a])c=this.context[a];return typeof c=="function"?c.apply(b):c!==undefined?c:""},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(a){return a=String(a===null?"":a),a.replace(/&(?!\w+;)|["<>\\]/g,function(a){switch(a){case"&":return"&amp;";case"\\":return"\\\\";case'"':return'"';case"<":return"&lt;";case">":return"&gt;";default:return a}})},create_context:function(a){if(this.is_object(a))return a;var b=".";this.pragmas["IMPLICIT-ITERATOR"]&&(b=this.pragmas["IMPLICIT-ITERATOR"].iterator);var c={};return c[b]=a,c},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function")return a.map(b);for(var c=[],d=a.length,e=0;e<d;e++)c.push(b(a[e]));return c}},{name:"mustache.js",version:"0.3.0",to_html:function(b,c,d,e){var g=new a;e&&(g.send=e),g.render(b,c,d);if(!e)return g.buffer.join("\n")}}}();window.ich=new function(){var c=this;c.VERSION="0.9",c.templates={},c.partials={},c.addTemplate=function(d,e){if(c[d])throw"Invalid name: "+d+".";if(c.templates[d])throw'Template " + name + " exists';c.templates[d]=e,c[d]=function(e,g){e=e||{};var h=b.to_html(c.templates[d],e,c.partials);return g?h:a(h)}},c.addPartial=function(a,b){if(c.partials[a])throw'Partial " + name + " exists';c.partials[a]=b},c.grabTemplates=function(){a('script[type="text/html"]').each(function(b,d){var e=a(typeof b=="number"?d:b),g="".trim?e.html().trim():a.trim(e.html());c[e.hasClass("partial")?"addPartial":"addTemplate"](e.attr("id"),g),e.remove()})},c.clearAll=function(){for(var a in c.templates)delete c[a];c.templates={},c.partials={}},c.refresh=function(){c.clearAll(),c.grabTemplates()}},a(function(){ich.grabTemplates()})})(window.jQuery||window.Zepto)